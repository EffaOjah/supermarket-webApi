<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Payslip - <%= payslip.first_name %> <%= payslip.last_name %></title>
    <link rel="stylesheet" href="/css/bootstrap.min.css" />
    <style>
      body {
        background-color: #f5f5f5;
        padding: 20px;
      }
      .payslip-container {
        max-width: 800px;
        margin: 0 auto;
        background: #fff;
        padding: 40px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
      .company-header {
        text-align: center;
        border-bottom: 2px solid #333;
        padding-bottom: 20px;
        margin-bottom: 30px;
      }
      .company-header h2 {
        margin: 0;
        color: #333;
        text-transform: uppercase;
      }
      .payslip-details {
        display: flex;
        justify-content: space-between;
        margin-bottom: 30px;
      }
      .payslip-table {
        width: 100%;
        margin-bottom: 30px;
      }
      .payslip-table th,
      .payslip-table td {
        padding: 10px;
        border-bottom: 1px solid #eee;
      }
      .payslip-table th {
        text-align: left;
        background-color: #f9f9f9;
      }
      .summary-box {
        background-color: #f9f9f9;
        padding: 20px;
        border-radius: 5px;
        display: flex;
        justify-content: space-between;
        font-weight: bold;
        font-size: 1.1em;
      }
      .net-pay {
        color: #28a745;
        font-size: 1.2em;
      }
      @media print {
        body {
          background: none;
          padding: 0;
        }
        .payslip-container {
          box-shadow: none;
          padding: 0;
        }
        .no-print {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <div class="payslip-container">
      <div class="company-header">
        <h2>MaryBill Conglomerate</h2>
        <!-- <p>123 High Street, Lagos, Nigeria</p> -->
        <h4>
          Payslip for <%= new
          Date(payslip.pay_period_start).toLocaleDateString('en-GB', { month:
          'long', year: 'numeric' }) %>
        </h4>
      </div>

      <div class="payslip-details">
        <div>
          <strong>Employee Name:</strong> <%= payslip.first_name %> <%=
          payslip.last_name %><br />
          <strong>Staff ID:</strong> <%= payslip.staff_id %><br />
          <strong>Department:</strong> <%= payslip.department %>
        </div>
        <div class="text-right">
          <strong>Pay Period:</strong> <%= new
          Date(payslip.pay_period_start).toLocaleDateString() %> - <%= new
          Date(payslip.pay_period_end).toLocaleDateString() %><br />
          <strong>Payment Date:</strong> <%= new Date().toLocaleDateString() %>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <h5>Earnings</h5>
          <table class="payslip-table">
            <thead>
              <tr>
                <th>Description</th>
                <th class="text-right">Amount</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Basic Salary</td>
                <td class="text-right">
                  ₦<%= payslip.basic_salary.toLocaleString() %>
                </td>
              </tr>
              <% payslip.structure.filter(i => i.type === 'Earning' && i.name
              !== 'Basic Salary').forEach(item => { %>
              <tr>
                <td><%= item.name %></td>
                <td class="text-right">
                  ₦<%= parseFloat(item.amount).toLocaleString() %>
                </td>
              </tr>
              <% }) %>
              <tr style="border-top: 2px solid #ddd; font-weight: bold">
                <td>Total Earnings</td>
                <td class="text-right">
                  <% const totalEarnings = payslip.basic_salary +
                  payslip.structure .filter(i => i.type === 'Earning' && i.name
                  !== 'Basic Salary') .reduce((sum, i) => sum +
                  (parseFloat(i.amount) || 0), 0); %> ₦<%=
                  totalEarnings.toLocaleString() %>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="col-md-6">
          <h5>Deductions</h5>
          <table class="payslip-table">
            <thead>
              <tr>
                <th>Description</th>
                <th class="text-right">Amount</th>
              </tr>
            </thead>
            <tbody>
              <% payslip.structure.filter(i => i.type ===
              'Deduction').forEach(item => { %>
              <tr>
                <td><%= item.name %></td>
                <td class="text-right">
                  ₦<%= parseFloat(item.amount).toLocaleString() %>
                </td>
              </tr>
              <% }) %>
              <tr style="border-top: 2px solid #ddd; font-weight: bold">
                <td>Total Deductions</td>
                <td class="text-right text-danger">
                  ₦<%= payslip.total_deductions.toLocaleString() %>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="summary-box mt-4">
        <span>Net Pay:</span>
        <span class="net-pay">₦<%= payslip.net_salary.toLocaleString() %></span>
      </div>

      <div class="mt-5 text-center no-print">
        <button onclick="window.print()" class="btn btn-primary btn-lg">
          Print Payslip
        </button>
        <button onclick="window.close()" class="btn btn-secondary btn-lg ml-2">
          Close
        </button>
      </div>
    </div>
  </body>
</html>
